{"version":3,"file":"slow.js","sources":["../src/rate-limit.js","../src/index.js"],"sourcesContent":["//only do foo promises at a time.\nconst rateLimit = function(arr, fn, limit = 5) {\n  return new Promise((resolve, reject) => {\n    //some validation\n    if (!arr || !fn) {\n      reject('Error: missing required parameters to rate-limit function')\n      return\n    }\n    if (arr.length === 0) {\n      resolve([])\n      return\n    }\n    let results = []\n    let n = limit - 1\n    let pending = 0\n\n    //simple recursion, but with then/finally\n    const go = function(i) {\n      pending += 1\n      let p = fn(arr[i])\n      if (!p.then) {\n        reject('Error: function must return a promise')\n        return\n      }\n      p.then(r => {\n        results[i] = r\n      })\n      p.catch(e => {\n        console.error(e)\n        results[i] = null\n      })\n      p.finally(() => {\n        pending -= 1\n        n += 1\n        //should we keep going?\n        if (arr.length >= n + 1) {\n          go(n)\n        } else if (pending <= 0) {\n          //no more to start - are we the last to finish?\n          resolve(results)\n        }\n      })\n    }\n\n    //fire-off first-n items\n    let init = arr.length < limit ? arr.length : limit\n    for (let i = 0; i < init; i += 1) {\n      go(i)\n    }\n  })\n}\nmodule.exports = rateLimit\n","const rate = require('./rate-limit')\n\nconst methods = {\n  one: (arr, fn) => {\n    return rate(arr, fn, 1)\n  },\n  two: (arr, fn) => {\n    return rate(arr, fn, 2)\n  },\n  three: (arr, fn) => {\n    return rate(arr, fn, 3)\n  },\n  four: (arr, fn) => {\n    return rate(arr, fn, 4)\n  },\n  five: (arr, fn) => {\n    return rate(arr, fn, 5)\n  },\n  ten: (arr, fn) => {\n    return rate(arr, fn, 10)\n  },\n  fifteen: (arr, fn) => {\n    return rate(arr, fn, 15)\n  },\n}\nmethods.serial = methods.one\nmethods.linear = methods.one\nmethods.crawl = methods.three\nmethods.walk = methods.five\nmethods.run = methods.ten\nmethods.sprint = methods.fifteen\n\nmodule.exports = methods\n"],"names":["rateLimit","arr","fn","limit","Promise","resolve","reject","length","results","n","pending","go","i","p","then","r","e","console","error","init","methods","one","rate","two","three","four","five","ten","fifteen","serial","linear","crawl","walk","run","sprint"],"mappings":"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"}